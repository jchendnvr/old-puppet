# Readme for old puppet repo

## Sets up a LEMP stack server for DRUPAL 6/7
I used to create Drupal version 6/7 websites and thus I created these puppet scripts to setup CentOS 6 VPS servers. 

These servers ran:
- Nginx
- PHP-FPM
- MariaDB
- Email services with Dovecot and Postfix
- In addition they needed to be backed up, monitored, and have proper SSL certificates. 




## Scripts to manage nodes. 
I created the following scripts


- **addnode** - for adding a new node to Puppet with a manifest .pp file in either manifests/int/ or manifests/biz/
  - This was based on if the machine was an internal or client machine
  - Example manifest creation 
  - The below passwords are randomly generated and unique each time. 
  - The complexity of them can be adjusted in the script.

```
sudo ./addnode 192.168.10.110 test.example.com biz serv


cat /etc/puppet/manifests/biz/test.example.com.pp
# Node generated by script/addnode
node 'test.example.com' {
  $DN = "${::fqdn}"
  $ROOTPASS = 'xP8fPwzTGLlABOBzcq'
  $ALLOWPORTS = [25,80,443,587,993]
  $SSH = 'CLIENT'
  $ROOTEMAIL = 'admin@example.com'
  $ROOTDBPASS = 'CHeRZiNb7pTUnN6YQz'
  $BACKUPUSERPASS = 'hgQz4swDkwAPqOtFuy'
  include role::serv
}

```
- **backupadd** - to add the machine to backup schedule on a backuppc server https://backuppc.github.io/backuppc/
- **cleannode** - cleanup after a old puppet node, removing any ssh keys and manifests. 
- **bootstrap** - This script was to bootstrap install puppet on the node. 


## You would change the following 
- puppet.conf > server name to your puppet server. 
- scripts/bootstrap - change TEMPPASS to a temp password used on your images
  - The bootstrap script uses this temp password to do things on the machine. 
  - Alternatively  your image could have a SSH key already baked in. 
- modules/ssh/files/authorized_keys_client and authorized keys internal to be actual SSH keys in your environment. 
- modules/ssh/files/sshd_config_client and sshd_config_internal ports are different than standard 22.
- Modify manifests/site.pp file timezone, cert information, and YOUR_ROOT_DB_PASS
- Change any instances of admin@example.com to your admin email account and email address. 
- Change backuppc@backup.example.com to your account and email. 
- modules/backuppc/files/httpbackupconf > change IP 192.168.10.110 to something applicable in your environment
- modules/backuppc/templates/sslconf.erb > change the listening port as desired. 
- modules/iptables/tempates/iptables.erb > change the rules to be applicable for your environment. 

## Monitoring 
I have included monitor examples with Nodeping and Statuscake websites. 
- You would want to modify the usernames and API Tokens referenced in those scripts 
- Then uncomment the corresponding check at the bottom of the bootstrap file 

## Backups 
- The backupadd script can be utilized if you have a backuppc running. 
- This will add the machine to a backup schedule and would be added to the 
- bottom of the bootstrap file as well.


## Additional Credit to [Andrew Grexa](https://github.com/grxy)
He worked on websites with me back then and no doubt helped with some of the non Puppet components of this repo. 